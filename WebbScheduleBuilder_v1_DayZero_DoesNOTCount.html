<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webb School 7-Day Rotation Schedule Builder - Fall 2026 v1 (Day Zero Does NOT Count)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1B5E3F 0%, #8DC63F 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1B5E3F 0%, #2B7A78 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.95;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        .info-banner {
            background: #E8F4F8;
            border: 1px solid #B3D9E8;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #2B7A78;
        }
        
        .info-banner h3 {
            margin-bottom: 10px;
            color: #1B5E3F;
        }
        
        .setup-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .setup-step {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .setup-step:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .step-number {
            background: #EF7D34;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .step-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #3D4241;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            font-weight: 500;
            color: #3D4241;
            margin-bottom: 5px;
        }
        
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #C9C49D;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #2B7A78;
        }
        
        .class-entry {
            background: white;
            border: 2px solid #C9C49D;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .class-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .class-name-input {
            font-weight: 600;
            font-size: 16px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 5px 10px;
            flex: 1;
            margin-right: 10px;
        }
        
        .remove-class-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .remove-class-btn:hover {
            background: #c82333;
        }
        
        .period-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .period-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .period-checkbox input[type="checkbox"] {
            width: auto;
            accent-color: #1B5E3F;
        }
        
        button {
            background: #1B5E3F;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
            margin-right: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(27, 94, 63, 0.3);
            background: #2B7A78;
        }
        
        .secondary-btn {
            background: #3D4241;
        }
        
        .secondary-btn:hover {
            box-shadow: 0 10px 20px rgba(61, 66, 65, 0.3);
            background: #555;
        }
        
        .rotation-schedule-display {
            background: white;
            border: 2px solid #C9C49D;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .rotation-schedule-display h4 {
            color: #1B5E3F;
            margin-bottom: 10px;
        }
        
        .rotation-day-item {
            background: #F5F5DC;
            border-left: 3px solid #8DC63F;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 4px;
        }
        
        .rotation-day-item strong {
            color: #1B5E3F;
        }
        
        .schedule-output {
            margin-top: 30px;
        }
        
        .cycle-section {
            background: white;
            border: 2px solid #C9C49D;
            border-radius: 12px;
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .cycle-header {
            background: linear-gradient(135deg, #1B5E3F 0%, #2B7A78 100%);
            color: white;
            padding: 15px 20px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .cycle-content {
            padding: 20px;
        }
        
        .day-row {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            background: white;
            transition: background 0.2s;
        }
        
        .day-row:hover {
            background: #f8f9fa;
        }
        
        .day-row:last-child {
            border-bottom: none;
        }
        
        .day-label {
            background: #8DC63F;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
            min-width: 60px;
        }
        
        .date-label {
            color: #3D4241;
            font-weight: 500;
            min-width: 120px;
        }
        
        .lessons-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            flex: 1;
        }
        
        .lesson-block {
            background: #F0F8F5;
            border: 1px solid #8DC63F;
            border-radius: 6px;
            padding: 6px 10px;
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .lesson-period {
            background: #2B7A78;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .lesson-number {
            color: #EF7D34;
            font-weight: 600;
            font-size: 14px;
        }
        
        .lesson-class {
            color: #3D4241;
            font-size: 14px;
        }
        
        .special-rule-indicator {
            background: #FFF3E6;
            border: 1px solid #EF7D34;
            color: #EF7D34;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .no-school-row {
            background: #F8F8F8;
        }
        
        .no-school-row .day-label {
            background: #C9C49D;
        }
        
        .no-school-label {
            color: #999;
            font-style: italic;
        }
        
        .help-text {
            color: #666;
            font-size: 13px;
            margin-top: 5px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .day-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 20px;
            }
        }

        /* Auto-save indicator styles */
        .save-indicator {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }

        .save-indicator.saved {
            background: rgba(76, 175, 80, 0.3);
        }

        .toolbar-buttons {
            position: absolute;
            top: 15px;
            left: 20px;
            display: flex;
            gap: 10px;
        }

        .toolbar-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .toolbar-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .file-management-section {
            background: #f0f8ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .file-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .file-btn:hover {
            background: #545b62;
        }

        .file-btn.danger {
            background: #dc3545;
        }

        .file-btn.danger:hover {
            background: #c82333;
        }

        @media print {
            .toolbar-buttons,
            .save-indicator,
            .file-management-section,
            button {
                display: none !important;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            
            body {
                background: white;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="toolbar-buttons">
                <button class="toolbar-btn" onclick="clearAll()">üóëÔ∏è Clear All</button>
            </div>
            <div class="save-indicator" id="saveIndicator">
                <span>‚úì</span>
                <span id="saveStatus">Auto-saving...</span>
            </div>
            <h1>Webb School Schedule Builder v1</h1>
            <p>7-Day Rotation Cycle Tracker - Fall 2026 (Autosave Enabled)</p>
        </div>
        
        <div class="content">
            <div class="info-banner">
                <h3>üìÖ Schedule Information</h3>
                <p><strong>Semester Start:</strong> Wednesday, August 12, 2026 (Day 1)</p>
                <p><strong>Semester End:</strong> Friday, December 4, 2026</p>
                <p><strong>Rotation Pattern:</strong> 7-day cycle with lessons numbered as Cycle.Lesson (e.g., 1.1, 1.2, 1.3, 1.4)</p>
                <p><strong>No School Days:</strong> Parent-Teacher Conferences (Aug 21, Oct 23), Labor Day (Sep 7), Yom Kippur (Sep 21), Fall Break (Oct 5-9), Professional Development (Nov 2), Thanksgiving (Nov 25-27)</p>
                <p><strong>Day Zero (All Classes Meet):</strong> Convocation/All School Photo (Aug 28), Grandparents Day (Nov 24) - <em>Day Zero does NOT count in the rotation cycle</em></p>
                <p style="margin-top: 10px; color: #28a745;"><strong>‚ú® Auto-save is enabled!</strong> Your data is automatically saved to your browser.</p>
            </div>
            
            <div class="file-management-section">
                <button class="file-btn" onclick="saveToFile()">üíæ Download Backup</button>
                <button class="file-btn" onclick="loadFromFile()">üìÇ Load Backup</button>
                <button class="file-btn" onclick="printSchedule()">üñ®Ô∏è Print</button>
                <button class="file-btn" onclick="exportSchedule()">üì• Export to CSV</button>
                <input type="file" id="fileInput" style="display: none;" accept=".json">
            </div>
            
            <div class="setup-section">
                <div class="setup-step">
                    <div class="step-header">
                        <span class="step-number">1</span>
                        <span class="step-title">Teacher Information</span>
                    </div>
                    <div class="input-group">
                        <label for="teacherName">Your Name (optional, for export filename)</label>
                        <input type="text" id="teacherName" placeholder="e.g., Diana Smith">
                    </div>
                </div>
                
                <div class="setup-step">
                    <div class="step-header">
                        <span class="step-number">2</span>
                        <span class="step-title">Define Your Classes</span>
                    </div>
                    <div id="classesContainer"></div>
                    <button onclick="addClass()">+ Add Another Class</button>
                </div>
                
                <div class="setup-step">
                    <div class="step-header">
                        <span class="step-number">3</span>
                        <span class="step-title">Special Scheduling Rules (Optional)</span>
                    </div>
                    <div class="input-group">
                        <label for="specialRules">Classes that meet on specific weekdays (e.g., yearbook meetings)</label>
                        <textarea id="specialRules" rows="3" placeholder="Example: Yearbook - Tuesday, Thursday&#10;Advisory - Wednesday"></textarea>
                        <div class="help-text">Format: ClassName - Day1, Day2, Day3</div>
                    </div>
                </div>
                
                <div class="setup-step">
                    <div class="step-header">
                        <span class="step-number">4</span>
                        <span class="step-title">Unexpected School Closures (Optional)</span>
                    </div>
                    <div class="input-group">
                        <label for="unexpectedClosures">Add any snow days or unexpected closures</label>
                        <input type="text" id="unexpectedClosures" placeholder="e.g., 2026-01-15, 2026-02-03">
                        <div class="help-text">Format: YYYY-MM-DD, separated by commas</div>
                    </div>
                </div>
                
                <div class="setup-step">
                    <div class="step-header">
                        <span class="step-number">5</span>
                        <span class="step-title">Generate Schedule</span>
                    </div>
                    <div class="input-group">
                        <label for="numCycles">Number of Cycles to Generate</label>
                        <input type="number" id="numCycles" min="1" max="10" value="4" style="width: 100px;">
                    </div>
                    <div class="action-buttons">
                        <button onclick="generateSchedule()">üìÖ Generate Schedule</button>
                    </div>
                </div>
            </div>
            
            <div class="rotation-schedule-display">
                <h4>7-Day Rotation Pattern</h4>
                <div class="rotation-day-item"><strong>Day 1:</strong> Periods A, B, C, D</div>
                <div class="rotation-day-item"><strong>Day 2:</strong> Periods E, G, A, F</div>
                <div class="rotation-day-item"><strong>Day 3:</strong> Periods B, D, E, C</div>
                <div class="rotation-day-item"><strong>Day 4:</strong> Periods F, A, D, G</div>
                <div class="rotation-day-item"><strong>Day 5:</strong> Periods E, F, B, C</div>
                <div class="rotation-day-item"><strong>Day 6:</strong> Periods A, B, G, D</div>
                <div class="rotation-day-item"><strong>Day 7:</strong> Periods G, C, E, F</div>
            </div>
            
            <div id="scheduleOutput" class="schedule-output"></div>
        </div>
    </div>
    
    <script>
        // ============================================================================
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë                                                                            ‚ïë
        // ‚ïë   üìÖ EDIT YOUR SCHEDULE DATES HERE - EASY TO UPDATE!                      ‚ïë
        // ‚ïë                                                                            ‚ïë
        // ‚ïë   This is the ONLY section you need to edit to update your schedule!      ‚ïë
        // ‚ïë   Change dates below to match your school calendar.                       ‚ïë
        // ‚ïë                                                                            ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // 1Ô∏è‚É£  SEMESTER START AND END DATES
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const SEMESTER_START = new Date('2026-08-12T00:00:00');  // First day of school
        const SEMESTER_END = new Date('2026-12-04T00:00:00');    // Last day of school
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // 2Ô∏è‚É£  NO SCHOOL DAYS (holidays, breaks, conferences, etc.)
        // Add or remove lines as needed. Format: { date: new Date('YYYY-MM-DDTHH:MM:SS'), name: 'Event Name' }
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const SCHEDULED_NO_SCHOOL_DAYS = [
            { date: new Date('2026-08-21T00:00:00'), name: 'Parent Teacher Conferences' },
            { date: new Date('2026-09-07T00:00:00'), name: 'Labor Day' },
            { date: new Date('2026-09-21T00:00:00'), name: 'Yom Kippur' },
            { date: new Date('2026-10-05T00:00:00'), name: 'Fall Break' },
            { date: new Date('2026-10-06T00:00:00'), name: 'Fall Break' },
            { date: new Date('2026-10-07T00:00:00'), name: 'Fall Break' },
            { date: new Date('2026-10-08T00:00:00'), name: 'Fall Break' },
            { date: new Date('2026-10-09T00:00:00'), name: 'Fall Break' },
            { date: new Date('2026-10-23T00:00:00'), name: 'Parent Conferences' },
            { date: new Date('2026-11-02T00:00:00'), name: 'Professional Development' },
            { date: new Date('2026-11-25T00:00:00'), name: 'Thanksgiving Break' },
            { date: new Date('2026-11-26T00:00:00'), name: 'Thanksgiving Break' },
            { date: new Date('2026-11-27T00:00:00'), name: 'Thanksgiving Break' },
        ];
        
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // 3Ô∏è‚É£  DAY ZERO DATES (all classes meet - Convocation, Grandparents Day, etc.)
        // These days show "Lesson 0.0" and do NOT count in the 7-day rotation cycle
        // Add or remove lines as needed. Format: { date: new Date('YYYY-MM-DDTHH:MM:SS'), name: 'Event Name' }
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const DAY_ZERO_DATES = [
            { date: new Date('2026-08-28T00:00:00'), name: 'Convocation / All School Photo' },
            { date: new Date('2026-11-24T00:00:00'), name: 'Grandparents Day' }
        ];
        
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë   ‚¨ÜÔ∏è  END OF EASY EDIT SECTION ‚¨ÜÔ∏è                                           ‚ïë
        // ‚ïë   Everything below this line should NOT need to be changed!                ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        // ----------------------------------------------------------------------------
        // ROTATION SCHEDULE PATTERN
        // 7-day rotation showing which periods meet each day
        // This should not need to be changed unless Webb changes the rotation pattern
        // ----------------------------------------------------------------------------
        const ROTATION_SCHEDULE = {
            1: ['A', 'B', 'C', 'D'],
            2: ['E', 'G', 'A', 'F'],
            3: ['B', 'D', 'E', 'C'],
            4: ['F', 'A', 'D', 'G'],
            5: ['E', 'F', 'B', 'C'],
            6: ['A', 'B', 'G', 'D'],
            7: ['G', 'C', 'E', 'F']
        };
        
        // ============================================================================
        // END OF SCHEDULE INFORMATION SECTION
        // ============================================================================
        
        let classData = {};
        let classIdCounter = 0;
        
        // ============================================================================
        // AUTO-SAVE AND FILE MANAGEMENT SYSTEM
        // ============================================================================
        
        // Storage key for localStorage
        const STORAGE_KEY = 'webbScheduleBuilderData';
        
        // Capture all form data for saving
        function captureAllData() {
            updateClassData();
            return {
                teacherName: document.getElementById('teacherName').value,
                classData: classData,
                specialRules: document.getElementById('specialRules').value,
                unexpectedClosures: document.getElementById('unexpectedClosures').value,
                numCycles: document.getElementById('numCycles').value,
                savedAt: new Date().toISOString(),
                version: '2.0' // Version tracking for future compatibility
            };
        }
        
        // Load saved data from localStorage
        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    // Restore teacher name
                    if (data.teacherName) {
                        document.getElementById('teacherName').value = data.teacherName;
                    }
                    
                    // Restore special rules
                    if (data.specialRules) {
                        document.getElementById('specialRules').value = data.specialRules;
                    }
                    
                    // Restore unexpected closures
                    if (data.unexpectedClosures) {
                        document.getElementById('unexpectedClosures').value = data.unexpectedClosures;
                    }
                    
                    // Restore num cycles
                    if (data.numCycles) {
                        document.getElementById('numCycles').value = data.numCycles;
                    }
                    
                    // Restore classes
                    if (data.classData && Object.keys(data.classData).length > 0) {
                        // Clear default class entry first
                        document.getElementById('classesContainer').innerHTML = '';
                        
                        // Recreate each class
                        Object.entries(data.classData).forEach(([id, cls]) => {
                            if (cls.name || cls.periods.length > 0) {
                                addClass();
                                const newId = classIdCounter - 1;
                                
                                // Set class name
                                const nameInput = document.getElementById(`className-${newId}`);
                                if (nameInput && cls.name) {
                                    nameInput.value = cls.name;
                                }
                                
                                // Set periods
                                cls.periods.forEach(period => {
                                    const checkbox = document.getElementById(`period-${newId}-${period}`);
                                    if (checkbox) {
                                        checkbox.checked = true;
                                    }
                                });
                            }
                        });
                    } else {
                        // If no saved classes, create one default
                        addClass();
                    }
                    
                    updateSaveIndicator('Data restored');
                } catch (error) {
                    console.error('Error loading saved data:', error);
                    addClass(); // Add default class on error
                }
            } else {
                // No saved data, create default class
                addClass();
            }
        }
        
        // Save data to localStorage
        function saveData() {
            const data = captureAllData();
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                updateSaveIndicator('Saved');
            } catch (error) {
                console.error('Error saving data:', error);
                updateSaveIndicator('Save failed', true);
            }
        }
        
        // Auto-save function with debouncing
        let saveTimeout;
        function autoSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveData();
            }, 1000); // Wait 1 second after last change
        }
        
        // Update save indicator
        function updateSaveIndicator(message = 'Saved', isError = false) {
            const indicator = document.getElementById('saveIndicator');
            const status = document.getElementById('saveStatus');
            
            indicator.classList.add('saved');
            status.textContent = message;
            
            if (isError) {
                indicator.style.background = 'rgba(244, 67, 54, 0.3)';
            } else {
                indicator.style.background = 'rgba(76, 175, 80, 0.3)';
            }
            
            setTimeout(() => {
                status.textContent = 'Auto-saving...';
                indicator.classList.remove('saved');
                indicator.style.background = 'rgba(255, 255, 255, 0.2)';
            }, 2000);
        }
        
        // Download backup as JSON
        function saveToFile() {
            const data = captureAllData();
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const teacherName = document.getElementById('teacherName').value;
            const dateStr = new Date().toISOString().split('T')[0];
            const fileName = teacherName ? 
                `${dateStr}_webb_schedule_${teacherName.replace(/\s+/g, '_')}.json` :
                `${dateStr}_webb_schedule_backup.json`;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
            updateSaveIndicator('Backup downloaded');
        }
        
        // Load backup from file
        function loadFromFile() {
            document.getElementById('fileInput').click();
        }
        
        // Print schedule
        function printSchedule() {
            window.print();
        }
        
        // Clear all data
        function clearAll() {
            if (confirm('Are you sure you want to clear all data? This will reset everything to default. Consider downloading a backup first.')) {
                localStorage.removeItem(STORAGE_KEY);
                
                // Clear form fields
                document.getElementById('teacherName').value = '';
                document.getElementById('specialRules').value = '';
                document.getElementById('unexpectedClosures').value = '';
                document.getElementById('numCycles').value = '4';
                
                // Clear classes and add one default
                document.getElementById('classesContainer').innerHTML = '';
                classData = {};
                classIdCounter = 0;
                addClass();
                
                // Clear output
                document.getElementById('scheduleOutput').innerHTML = '';
                
                updateSaveIndicator('All data cleared');
            }
        }
        
        // Setup file input handler
        function setupFileInput() {
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        // Clear current data
                        document.getElementById('classesContainer').innerHTML = '';
                        classData = {};
                        classIdCounter = 0;
                        
                        // Restore all data
                        if (data.teacherName !== undefined) {
                            document.getElementById('teacherName').value = data.teacherName;
                        }
                        if (data.specialRules !== undefined) {
                            document.getElementById('specialRules').value = data.specialRules;
                        }
                        if (data.unexpectedClosures !== undefined) {
                            document.getElementById('unexpectedClosures').value = data.unexpectedClosures;
                        }
                        if (data.numCycles !== undefined) {
                            document.getElementById('numCycles').value = data.numCycles;
                        }
                        
                        // Restore classes
                        if (data.classData && Object.keys(data.classData).length > 0) {
                            Object.entries(data.classData).forEach(([id, cls]) => {
                                if (cls.name || cls.periods.length > 0) {
                                    addClass();
                                    const newId = classIdCounter - 1;
                                    
                                    const nameInput = document.getElementById(`className-${newId}`);
                                    if (nameInput && cls.name) {
                                        nameInput.value = cls.name;
                                    }
                                    
                                    cls.periods.forEach(period => {
                                        const checkbox = document.getElementById(`period-${newId}-${period}`);
                                        if (checkbox) {
                                            checkbox.checked = true;
                                        }
                                    });
                                }
                            });
                        } else {
                            addClass();
                        }
                        
                        saveData();
                        updateSaveIndicator('Backup loaded successfully');
                    } catch (error) {
                        alert('Error loading file. Please make sure it\'s a valid Webb Schedule backup file.');
                        console.error('Load error:', error);
                    }
                };
                reader.readAsText(file);
                
                // Clear the file input so the same file can be selected again
                e.target.value = '';
            });
        }
        
        // Setup auto-save triggers
        function setupAutoSaveListeners() {
            // Add listeners to all inputs for auto-save
            document.getElementById('teacherName').addEventListener('input', autoSave);
            document.getElementById('specialRules').addEventListener('input', autoSave);
            document.getElementById('unexpectedClosures').addEventListener('input', autoSave);
            document.getElementById('numCycles').addEventListener('change', autoSave);
        }
        
        function addClass() {
            const classId = classIdCounter++;
            const container = document.getElementById('classesContainer');
            
            const classDiv = document.createElement('div');
            classDiv.className = 'class-entry';
            classDiv.id = `class-${classId}`;
            
            classDiv.innerHTML = `
                <div class="class-entry-header">
                    <input type="text" class="class-name-input" id="className-${classId}" placeholder="Class Name (e.g., AP English 11)" onchange="autoSave()">
                    <button class="remove-class-btn" onclick="removeClass(${classId})">Remove</button>
                </div>
                <div class="period-checkboxes">
                    ${['A', 'B', 'C', 'D', 'E', 'F', 'G'].map(period => `
                        <label class="period-checkbox">
                            <input type="checkbox" id="period-${classId}-${period}" value="${period}" onchange="autoSave()">
                            <span>Period ${period}</span>
                        </label>
                    `).join('')}
                </div>
            `;
            
            container.appendChild(classDiv);
            
            // Initialize class data
            classData[classId] = {
                name: '',
                periods: []
            };
            
            autoSave(); // Save after adding class
        }
        
        function removeClass(classId) {
            const element = document.getElementById(`class-${classId}`);
            if (element) {
                element.remove();
                delete classData[classId];
                autoSave(); // Save after removing class
            }
        }
        
        function updateClassData() {
            Object.keys(classData).forEach(classId => {
                const nameInput = document.getElementById(`className-${classId}`);
                if (nameInput) {
                    classData[classId].name = nameInput.value;
                    
                    const periods = [];
                    ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(period => {
                        const checkbox = document.getElementById(`period-${classId}-${period}`);
                        if (checkbox && checkbox.checked) {
                            periods.push(period);
                        }
                    });
                    classData[classId].periods = periods;
                }
            });
        }
        
        function parseSpecialRules(rulesText) {
            const rules = [];
            if (!rulesText.trim()) return rules;
            
            const lines = rulesText.split('\n');
            lines.forEach(line => {
                const match = line.match(/(.+?)\s*-\s*(.+)/);
                if (match) {
                    const className = match[1].trim();
                    const daysText = match[2].trim();
                    const days = [];
                    
                    const dayMap = {
                        'sunday': 0, 'sun': 0,
                        'monday': 1, 'mon': 1,
                        'tuesday': 2, 'tue': 2, 'tues': 2,
                        'wednesday': 3, 'wed': 3,
                        'thursday': 4, 'thu': 4, 'thurs': 4,
                        'friday': 5, 'fri': 5,
                        'saturday': 6, 'sat': 6
                    };
                    
                    daysText.split(',').forEach(day => {
                        const cleanDay = day.trim().toLowerCase();
                        if (dayMap[cleanDay] !== undefined) {
                            days.push(dayMap[cleanDay]);
                        }
                    });
                    
                    if (days.length > 0) {
                        rules.push({ className, days });
                    }
                }
            });
            
            return rules;
        }
        
        function parseUnexpectedDays() {
            const input = document.getElementById('unexpectedClosures').value;
            const dates = [];
            
            if (!input.trim()) return dates;
            
            input.split(',').forEach(dateStr => {
                const trimmed = dateStr.trim();
                if (trimmed) {
                    const date = new Date(trimmed + 'T00:00:00');
                    if (!isNaN(date.getTime())) {
                        dates.push(date);
                    }
                }
            });
            
            return dates;
        }
        
        function generateSchedule() {
            updateClassData();
            
            const numCycles = parseInt(document.getElementById('numCycles').value);
            const specialRules = parseSpecialRules(document.getElementById('specialRules').value);
            const unexpectedDays = parseUnexpectedDays();
            
            // Combine all no-school days
            const allNoSchoolDays = [...SCHEDULED_NO_SCHOOL_DAYS, ...unexpectedDays];
            
            // Create a mapping of periods to classes
            const periodToClass = {};
            Object.values(classData).forEach(cls => {
                cls.periods.forEach(period => {
                    periodToClass[period] = cls.name;
                });
            });
            
            // Track lesson progress for each period
            const lessonTrackers = {};
            Object.values(classData).forEach(cls => {
                cls.periods.forEach(period => {
                    lessonTrackers[period] = { 
                        className: cls.name, 
                        currentLesson: 1 
                    };
                });
            });
            
            let output = '<div class="schedule-container">';
            let currentDate = new Date(SEMESTER_START);
            let rotationDay = 1;
            
            for (let cycle = 1; cycle <= numCycles; cycle++) {
                output += `<div class="cycle-section">`;
                output += `<div class="cycle-header">Cycle ${cycle}</div>`;
                output += `<div class="cycle-content">`;
                
                // Track days in this cycle
                let daysInCycle = 0;
                
                while (daysInCycle < 7) {
                    // Skip weekends
                    while (currentDate.getDay() === 0 || currentDate.getDay() === 6) {
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    
                    // Check if this is a no-school day
                    const scheduledOff = SCHEDULED_NO_SCHOOL_DAYS.find(d => 
                        currentDate.toDateString() === d.date.toDateString()
                    );
                    const isUnexpectedOff = unexpectedDays.some(d => 
                        currentDate.toDateString() === d.toDateString()
                    );
                    
                    if (scheduledOff || isUnexpectedOff) {
                        const dateStr = currentDate.toLocaleDateString('en-US', { 
                            weekday: 'short', 
                            month: 'short', 
                            day: 'numeric' 
                        });
                        
                        output += `<div class="day-row no-school-row">`;
                        output += `<div class="day-label">Day ${rotationDay}</div>`;
                        output += `<div class="date-label">${dateStr}</div>`;
                        output += `<div class="lessons-container">`;
                        
                        if (isUnexpectedOff) {
                            output += `<span class="no-school-label">Unexpected Closure</span>`;
                        } else {
                            output += `<span class="no-school-label">${scheduledOff.name}</span>`;
                        }
                        output += `</div></div>`;
                        
                        currentDate.setDate(currentDate.getDate() + 1);
                        continue; // Don't advance rotation day
                    }
                    
                    // Check if this is a Day Zero (all classes meet)
                    const isDayZero = DAY_ZERO_DATES.find(d => 
                        currentDate.toDateString() === d.date.toDateString()
                    );
                    
                    const dateStr = currentDate.toLocaleDateString('en-US', { 
                        weekday: 'short', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                    
                    const dayOfWeek = currentDate.getDay();
                    
                    if (isDayZero) {
                        // Day Zero: Show all classes with lesson number 0.0
                        output += `<div class="day-row day-zero-row">`;
                        output += `<div class="day-label" style="background: #EF7D34;">Day 0</div>`;
                        output += `<div class="date-label">${dateStr}</div>`;
                        output += `<div class="lessons-container">`;
                        output += `<div style="font-weight: bold; color: #EF7D34; margin-bottom: 10px;">${isDayZero.name}</div>`;
                        
                        // Show all classes (all periods A-G)
                        const allPeriods = ['A', 'B', 'C', 'D', 'E', 'F', 'G'];
                        allPeriods.forEach(period => {
                            if (lessonTrackers[period]) {
                                const tracker = lessonTrackers[period];
                                output += `<div class="lesson-block">`;
                                output += `<span class="lesson-period">${period}</span>`;
                                output += `<span class="lesson-number">0.0</span>`;
                                output += `<span class="lesson-class">${tracker.className}</span>`;
                                output += `</div>`;
                            }
                        });
                        
                        // Add special rules classes if applicable
                        specialRules.forEach(rule => {
                            if (rule.days.includes(dayOfWeek)) {
                                output += `<div class="special-rule-indicator">üìÖ ${rule.className}</div>`;
                            }
                        });
                        
                        output += `</div></div>`;
                        
                        // Day Zero does NOT advance the rotation or count toward cycle days
                        currentDate.setDate(currentDate.getDate() + 1);
                    } else {
                        // Regular rotation day processing
                    output += `<div class="day-row">`;
                    output += `<div class="day-label">Day ${rotationDay}</div>`;
                    output += `<div class="date-label">${dateStr}</div>`;
                    output += `<div class="lessons-container">`;
                    
                    const dayPeriods = ROTATION_SCHEDULE[rotationDay] || [];
                    const lessonsToday = [];
                    
                    // Add regular rotation classes
                    dayPeriods.forEach(period => {
                        if (lessonTrackers[period]) {
                            const tracker = lessonTrackers[period];
                            const lessonNum = `${cycle}.${tracker.currentLesson}`;
                            
                            lessonsToday.push({
                                period: period,
                                lessonNum: lessonNum,
                                className: tracker.className
                            });
                            
                            // Increment for next time this period appears
                            tracker.currentLesson++;
                            if (tracker.currentLesson > 4) {
                                tracker.currentLesson = 1;
                            }
                        }
                    });
                    
                    // Add lessons first
                    if (lessonsToday.length > 0) {
                        lessonsToday.forEach(lesson => {
                            output += `<div class="lesson-block">`;
                            output += `<span class="lesson-period">${lesson.period}</span>`;
                            output += `<span class="lesson-number">${lesson.lessonNum}</span>`;
                            output += `<span class="lesson-class">${lesson.className}</span>`;
                            output += `</div>`;
                        });
                    }
                    
                    // Add special rules classes
                    specialRules.forEach(rule => {
                        if (rule.days.includes(dayOfWeek)) {
                            output += `<div class="special-rule-indicator">üìÖ ${rule.className}</div>`;
                        }
                    });
                    
                    if (lessonsToday.length === 0 && !specialRules.some(rule => rule.days.includes(dayOfWeek))) {
                        output += `<span style="color: #999; font-style: italic;">No classes scheduled</span>`;
                    }
                    
                    output += `</div></div>`;
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                    rotationDay = (rotationDay % 7) + 1;
                    daysInCycle++;
                    } // End of else block for regular day processing
                }
                
                // Reset lesson counters for next cycle
                Object.keys(lessonTrackers).forEach(period => {
                    lessonTrackers[period].currentLesson = 1;
                });
                
                output += `</div></div>`;
            }
            
            output += '</div>';
            
            document.getElementById('scheduleOutput').innerHTML = output;
            
            // Auto-save after generating schedule
            autoSave();
        }
        
        function exportSchedule() {
            const numCycles = parseInt(document.getElementById('numCycles').value);
            const teacherName = document.getElementById('teacherName').value;
            const specialRules = parseSpecialRules(document.getElementById('specialRules').value);
            const unexpectedDays = parseUnexpectedDays();
            
            // Combine all no-school days
            const allNoSchoolDays = [...SCHEDULED_NO_SCHOOL_DAYS, ...unexpectedDays];
            
            // Create period-to-class mapping
            const periodToClass = {};
            Object.values(classData).forEach(cls => {
                cls.periods.forEach(period => {
                    periodToClass[period] = cls.name;
                });
            });
            
            // Get all unique periods
            const allPeriods = [...new Set(Object.keys(periodToClass))].sort();
            
            // Add special rules classes to header
            const specialClassNames = [...new Set(specialRules.map(r => r.className))];
            
            // CSV header
            let csv = 'Date,Day,Rotation Day,' + allPeriods.map(p => `Period ${p}`).join(',');
            if (specialClassNames.length > 0) {
                csv += ',' + specialClassNames.join(',');
            }
            csv += ',Notes\n';
            
            // Track lesson progress
            const lessonTrackers = {};
            Object.values(classData).forEach(cls => {
                cls.periods.forEach(period => {
                    lessonTrackers[period] = { 
                        className: cls.name, 
                        currentLesson: 1 
                    };
                });
            });
            
            // Add trackers for special rules classes
            const specialTrackers = {};
            specialRules.forEach(rule => {
                specialTrackers[rule.className] = {
                    currentSession: 1
                };
            });
            
            let currentDate = new Date(SEMESTER_START);
            let rotationDay = 1;
            
            for (let cycle = 1; cycle <= numCycles; cycle++) {
                let daysInCycle = 0;
                while (daysInCycle < 7) {
                    while (currentDate.getDay() === 0 || currentDate.getDay() === 6) {
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    
                    const scheduledOff = SCHEDULED_NO_SCHOOL_DAYS.find(d => 
                        currentDate.toDateString() === d.date.toDateString()
                    );
                    const isUnexpectedOff = unexpectedDays.some(d => 
                        currentDate.toDateString() === d.toDateString()
                    );
                    
                    const dateStr = currentDate.toISOString().split('T')[0];
                    const dayName = currentDate.toLocaleDateString('en-US', { weekday: 'long' });
                    
                    if (scheduledOff || isUnexpectedOff) {
                        let row = `${dateStr},${dayName},Day ${rotationDay},` + allPeriods.map(p => 'No School').join(',');
                        if (specialClassNames.length > 0) {
                            row += ',' + specialClassNames.map(c => 'No School').join(',');
                        }
                        row += ',' + (isUnexpectedOff ? 'Unexpected Closure' : scheduledOff.name);
                        csv += row + '\n';
                        currentDate.setDate(currentDate.getDate() + 1);
                        continue;
                    }
                    
                    // Check if this is a Day Zero (all classes meet)
                    const isDayZero = DAY_ZERO_DATES.find(d => 
                        currentDate.toDateString() === d.date.toDateString()
                    );
                    
                    if (isDayZero) {
                        // Day Zero: All classes meet with lesson 0.0
                        const dayZeroData = {};
                        allPeriods.forEach(period => {
                            if (lessonTrackers[period]) {
                                dayZeroData[period] = `${lessonTrackers[period].className} - Lesson 0.0`;
                            }
                        });
                        
                        let row = `${dateStr},${dayName},Day 0,` + allPeriods.map(p => dayZeroData[p] || '').join(',');
                        
                        if (specialClassNames.length > 0) {
                            const dayOfWeek = currentDate.getDay();
                            const specialData = specialClassNames.map(className => {
                                const rule = specialRules.find(r => r.className === className);
                                if (rule && rule.days.includes(dayOfWeek)) {
                                    const sessionNum = specialTrackers[className].currentSession;
                                    specialTrackers[className].currentSession++;
                                    return `${className} - Session ${sessionNum}`;
                                }
                                return '';
                            });
                            row += ',' + specialData.join(',');
                        }
                        
                        row += ',' + isDayZero.name;
                        csv += row + '\n';
                        currentDate.setDate(currentDate.getDate() + 1);
                    } else {
                        // Regular rotation day processing
                    const dayOfWeek = currentDate.getDay();
                    const dayPeriods = ROTATION_SCHEDULE[rotationDay] || [];
                    const periodData = {};
                    
                    dayPeriods.forEach(period => {
                        if (lessonTrackers[period]) {
                            const tracker = lessonTrackers[period];
                            const lessonNum = `${cycle}.${tracker.currentLesson}`;
                            periodData[period] = `${tracker.className} - Lesson ${lessonNum}`;
                            tracker.currentLesson++;
                            if (tracker.currentLesson > 4) {
                                tracker.currentLesson = 1;
                            }
                        }
                    });
                    
                    let row = `${dateStr},${dayName},Day ${rotationDay},` + allPeriods.map(p => periodData[p] || '').join(',');
                    
                    // Add special rules data with session numbers
                    if (specialClassNames.length > 0) {
                        const specialData = specialClassNames.map(className => {
                            const rule = specialRules.find(r => r.className === className);
                            if (rule && rule.days.includes(dayOfWeek)) {
                                const sessionNum = specialTrackers[className].currentSession;
                                specialTrackers[className].currentSession++;
                                return `${className} - Session ${sessionNum}`;
                            }
                            return '';
                        });
                        row += ',' + specialData.join(',');
                    }
                    
                    row += ','; // Empty notes column for regular days
                    csv += row + '\n';
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                    rotationDay = (rotationDay % 7) + 1;
                    daysInCycle++;
                    } // End of else block for regular day processing
                }
                
                Object.keys(lessonTrackers).forEach(period => {
                    lessonTrackers[period].currentLesson = 1;
                });
            }
            
            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const dateStr = new Date().toISOString().split('T')[0];
            const filename = teacherName ? 
                `${dateStr}_${teacherName.replace(/\s+/g, '_')}_schedule.csv` : 
                `${dateStr}_webb_schedule.csv`;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        // Initialize with saved data on load
        window.addEventListener('DOMContentLoaded', function() {
            setupFileInput();
            setupAutoSaveListeners();
            loadData(); // This will load saved data or create default class
        });
        
        // Auto-save before page unload
        window.addEventListener('beforeunload', function() {
            saveData();
        });
    </script>
</body>
</html>